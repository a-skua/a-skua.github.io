---
layout: post
title: "Linuxで始めるOS自作入門: 4日目"
categories:
  - "OS自作入門"
---

３日目が約１年前...
再開しました  
３日目でC言語を使えるようにしたので、
C言語で画面を表示してみようという内容になっています

`goto LABEL`を`for`に書き直したり...
```c
fin:
    io_hlt();
    goto fin;
```
```c
for (;;) {
    io_hlt();
}
```

久しぶりすぎて詰まったところといえば、
`nasfunc.nas`に関数を追加したときに`GLOBAL`を書き忘れたくらいかなーと

8, 16, and 32 bits
のデータを扱う場合、
それぞれ対応した型である
`char`, `sort`, and `int`を使おうねーとか、
ポインターはアドレスなんで4bytesだよーとかそんな感じ

`*(p + i)`は`p[i]`なので`i[p]`とも書けるよーとか

`static`はアセンブリの`DB`に相当するよーとか

言葉的に迷ったのが`PUSHFD`と`POPFD`
それぞれフラグの値を取り出すためのものなのだけど、
- `PUSHFD` -> フラグの値をスタックにpushする（取り出す）
- `POPFD` -> スタックから値をpopし、フラグに設定する（渡す）
push and pop はスタックベースに考えよう
(フラグベースに考えると混乱する)

知識のおさらいとしては、
***C言語の規約ではreturnしたときにEAXに入っていた値が関数の戻り値とみなされる***
かな  
これはFE試験のCASLL2も同じような仕様だったと記憶している

再開が１年ぶりになってしまってたのだけど、  
git管理していたり
`Makefile`や`.gitignore`をきちんと設定していた
１年前の自分に感謝

４日目の最後には、こんな感じの画面が出来上がっていたよ  
![OSの画面]({{ site.url }}/assets/img/posts/2020-03-30-os_4day.png)
